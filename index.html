<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Once Upon a Tower</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            overflow: hidden;
            user-select: none;
        }
        
        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10;
            transition: opacity 0.5s ease;
        }
        
        .hidden {
            display: none !important;
        }
        
        h1 {
            font-size: 4rem;
            margin-bottom: 2rem;
            text-align: center;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.7);
        }
        
        h2 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: #ffcc00;
        }
        
        .btn {
            background: linear-gradient(to bottom, #ffcc00, #ff9900);
            color: #1a1a2e;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 204, 0, 0.6);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-secondary {
            background: linear-gradient(to bottom, #4a4a8a, #2d2d5a);
            color: #fff;
        }
        
        #shop-screen, #upgrades-screen, #skins-screen {
            padding: 20px;
            overflow-y: auto;
        }
        
        .shop-items, .upgrades-list, .skins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            width: 90%;
            max-width: 1200px;
            margin-top: 20px;
        }
        
        .shop-item, .upgrade-item, .skin-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .shop-item:hover, .upgrade-item:hover, .skin-item:hover {
            transform: translateY(-5px);
            border-color: #ffcc00;
        }
        
        .shop-item img, .upgrade-item img, .skin-item img {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
            border-radius: 10px;
        }
        
        .item-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #ffcc00;
        }
        
        .item-description {
            font-size: 0.9rem;
            margin-bottom: 15px;
            color: #ccc;
        }
        
        .item-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffcc00;
            margin-bottom: 15px;
        }
        
        .owned {
            background: rgba(0, 255, 0, 0.2);
        }
        
        .equipped {
            border-color: #00ff00;
        }
        
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 5;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .hud-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .hud-icon {
            width: 30px;
            height: 30px;
            background: #ffcc00;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #1a1a2e;
        }
        
        .hud-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        #game-over-screen {
            text-align: center;
        }
        
        #final-stats {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            max-width: 500px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .stat-value {
            color: #ffcc00;
            font-weight: bold;
        }
        
        #tower {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 500px;
            background: linear-gradient(to right, #8b4513, #a0522d);
            z-index: 2;
            border: 5px solid #5d2906;
            border-bottom: none;
            border-radius: 20px 20px 0 0;
        }
        
        #player {
            position: absolute;
            width: 50px;
            height: 50px;
            background: #ff0000;
            border-radius: 50%;
            z-index: 3;
            transition: all 0.1s ease;
        }
        
        .enemy {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #00ff00;
            border-radius: 5px;
            z-index: 3;
        }
        
        .projectile {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffff00;
            border-radius: 50%;
            z-index: 3;
        }
        
        .coin {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ffcc00;
            border-radius: 50%;
            z-index: 3;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 5;
        }
        
        .control-btn {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .control-btn:active {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0.9);
        }
        
        #pause-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 5;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.5rem;
            z-index: 20;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        
        <div id="hud">
            <div class="hud-item">
                <div class="hud-icon">‚ù§</div>
                <div class="hud-value" id="health">100</div>
            </div>
            <div class="hud-item">
                <div class="hud-icon">‚ö°</div>
                <div class="hud-value" id="energy">100</div>
            </div>
            <div class="hud-item">
                <div class="hud-icon">üí∞</div>
                <div class="hud-value" id="coins">0</div>
            </div>
            <div class="hud-item">
                <div class="hud-icon">üèÜ</div>
                <div class="hud-value" id="score">0</div>
            </div>
            <div class="hud-item">
                <div class="hud-icon">‚¨Ü</div>
                <div class="hud-value" id="floor">1</div>
            </div>
        </div>
        
        <button id="pause-btn">‚è∏</button>
        
        <div id="controls">
            <div class="control-btn" id="left-btn">‚Üê</div>
            <div class="control-btn" id="jump-btn">‚Üë</div>
            <div class="control-btn" id="attack-btn">‚öî</div>
            <div class="control-btn" id="right-btn">‚Üí</div>
        </div>
        
        <div id="main-menu" class="screen">
            <h1>Once Upon a Tower</h1>
            <button class="btn" id="start-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            <button class="btn btn-secondary" id="shop-btn">–ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="btn btn-secondary" id="upgrades-btn">–£—Å–∏–ª–µ–Ω–∏—è</button>
            <button class="btn btn-secondary" id="skins-btn">–°–∫–∏–Ω—ã</button>
        </div>
        
        <div id="shop-screen" class="screen hidden">
            <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
            <div class="shop-items">
                <div class="shop-item">
                    <div class="item-title">–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è</div>
                    <div class="item-description">–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 50 –∑–¥–æ—Ä–æ–≤—å—è</div>
                    <div class="item-price">10 –º–æ–Ω–µ—Ç</div>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <div class="item-title">–ó–µ–ª—å–µ —ç–Ω–µ—Ä–≥–∏–∏</div>
                    <div class="item-description">–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 50 —ç–Ω–µ—Ä–≥–∏–∏</div>
                    <div class="item-price">10 –º–æ–Ω–µ—Ç</div>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <div class="item-title">–£—Å–∏–ª–µ–Ω–∏–µ –∞—Ç–∞–∫–∏</div>
                    <div class="item-description">+10% –∫ —É—Ä–æ–Ω—É –Ω–∞ 5 –º–∏–Ω—É—Ç</div>
                    <div class="item-price">25 –º–æ–Ω–µ—Ç</div>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <div class="item-title">–ó–∞—â–∏—Ç–Ω—ã–π —â–∏—Ç</div>
                    <div class="item-description">–ü–æ–≥–ª–æ—â–∞–µ—Ç 50 —É—Ä–æ–Ω–∞</div>
                    <div class="item-price">30 –º–æ–Ω–µ—Ç</div>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <button class="btn btn-secondary" id="back-from-shop">–ù–∞–∑–∞–¥</button>
        </div>
        
        <div id="upgrades-screen" class="screen hidden">
            <h2>–£—Å–∏–ª–µ–Ω–∏—è</h2>
            <div class="upgrades-list">
                <div class="upgrade-item">
                    <div class="item-title">–°–∏–ª–∞</div>
                    <div class="item-description">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É—Ä–æ–Ω –æ—Ç –∞—Ç–∞–∫</div>
                    <div class="item-price">–£—Ä–æ–≤–µ–Ω—å: 1</div>
                    <button class="btn">–£–ª—É—á—à–∏—Ç—å (50 –º–æ–Ω–µ—Ç)</button>
                </div>
                <div class="upgrade-item">
                    <div class="item-title">–ó–¥–æ—Ä–æ–≤—å–µ</div>
                    <div class="item-description">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ</div>
                    <div class="item-price">–£—Ä–æ–≤–µ–Ω—å: 1</div>
                    <button class="btn">–£–ª—É—á—à–∏—Ç—å (50 –º–æ–Ω–µ—Ç)</button>
                </div>
                <div class="upgrade-item">
                    <div class="item-title">–≠–Ω–µ—Ä–≥–∏—è</div>
                    <div class="item-description">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é</div>
                    <div class="item-price">–£—Ä–æ–≤–µ–Ω—å: 1</div>
                    <button class="btn">–£–ª—É—á—à–∏—Ç—å (50 –º–æ–Ω–µ—Ç)</button>
                </div>
                <div class="upgrade-item">
                    <div class="item-title">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                    <div class="item-description">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è</div>
                    <div class="item-price">–£—Ä–æ–≤–µ–Ω—å: 1</div>
                    <button class="btn">–£–ª—É—á—à–∏—Ç—å (50 –º–æ–Ω–µ—Ç)</button>
                </div>
            </div>
            <button class="btn btn-secondary" id="back-from-upgrades">–ù–∞–∑–∞–¥</button>
        </div>
        
        <div id="skins-screen" class="screen hidden">
            <h2>–°–∫–∏–Ω—ã</h2>
            <div class="skins-grid">
                <div class="skin-item equipped">
                    <div class="item-title">–†—ã—Ü–∞—Ä—å</div>
                    <div class="item-description">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∫–∏–Ω</div>
                    <button class="btn">–í—ã–±—Ä–∞–Ω–æ</button>
                </div>
                <div class="skin-item">
                    <div class="item-title">–í–æ–ª—à–µ–±–Ω–∏–∫</div>
                    <div class="item-description">+10% –∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é —ç–Ω–µ—Ä–≥–∏–∏</div>
                    <div class="item-price">100 –º–æ–Ω–µ—Ç</div>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="skin-item">
                    <div class="item-title">–õ—É—á–Ω–∏–∫</div>
                    <div class="item-description">+15% –∫ –¥–∞–ª—å–Ω–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏</div>
                    <div class="item-price">150 –º–æ–Ω–µ—Ç</div>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="skin-item">
                    <div class="item-title">–ù–∏–Ω–¥–∑—è</div>
                    <div class="item-description">+20% –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è</div>
                    <div class="item-price">200 –º–æ–Ω–µ—Ç</div>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <button class="btn btn-secondary" id="back-from-skins">–ù–∞–∑–∞–¥</button>
        </div>
        
        <div id="game-over-screen" class="screen hidden">
            <h1>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h1>
            <div id="final-stats">
                <div class="stat-row">
                    <span>–≠—Ç–∞–∂:</span>
                    <span class="stat-value" id="final-floor">1</span>
                </div>
                <div class="stat-row">
                    <span>–°—á—ë—Ç:</span>
                    <span class="stat-value" id="final-score">0</span>
                </div>
                <div class="stat-row">
                    <span>–ú–æ–Ω–µ—Ç—ã:</span>
                    <span class="stat-value" id="final-coins">0</span>
                </div>
                <div class="stat-row">
                    <span>–í—Ä–∞–≥–∏ –ø–æ–±–µ–∂–¥–µ–Ω—ã:</span>
                    <span class="stat-value" id="final-enemies">0</span>
                </div>
                <div class="stat-row">
                    <span>–†–µ–∫–æ—Ä–¥:</span>
                    <span class="stat-value" id="final-highscore">0</span>
                </div>
            </div>
            <button class="btn" id="restart-btn">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            <button class="btn btn-secondary" id="menu-btn">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>
        
        <div id="notification" class="notification hidden"></div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        const gameState = {
            currentScreen: 'main-menu',
            isPaused: false,
            player: {
                x: canvas.width / 2,
                y: canvas.height - 150,
                width: 50,
                height: 50,
                speed: 5,
                jumpForce: 15,
                velocityY: 0,
                isJumping: false,
                health: 100,
                maxHealth: 100,
                energy: 100,
                maxEnergy: 100,
                attackDamage: 10,
                coins: 0,
                score: 0,
                floor: 1,
                skin: 'knight'
            },
            enemies: [],
            projectiles: [],
            coins: [],
            platforms: [],
            gravity: 0.8,
            keys: {},
            gameTime: 0,
            enemySpawnTimer: 0,
            coinSpawnTimer: 0,
            upgrades: {
                strength: 1,
                health: 1,
                energy: 1,
                speed: 1
            },
            skins: {
                knight: { owned: true, equipped: true, bonus: '' },
                wizard: { owned: false, bonus: '+10% energy regen' },
                archer: { owned: false, bonus: '+15% attack range' },
                ninja: { owned: false, bonus: '+20% movement speed' }
            },
            highScore: 0
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
            createPlatform(canvas.width / 2 - 100, canvas.height - 100, 200, 20);
            createPlatform(canvas.width / 2 - 80, canvas.height - 200, 160, 20);
            createPlatform(canvas.width / 2 - 60, canvas.height - 300, 120, 20);
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            gameLoop();
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        function createPlatform(x, y, width, height) {
            gameState.platforms.push({
                x: x,
                y: y,
                width: width,
                height: height
            });
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('shop-btn').addEventListener('click', () => showScreen('shop-screen'));
            document.getElementById('upgrades-btn').addEventListener('click', () => showScreen('upgrades-screen'));
            document.getElementById('skins-btn').addEventListener('click', () => showScreen('skins-screen'));
            
            // –ö–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
            document.getElementById('back-from-shop').addEventListener('click', () => showScreen('main-menu'));
            document.getElementById('back-from-upgrades').addEventListener('click', () => showScreen('main-menu'));
            document.getElementById('back-from-skins').addEventListener('click', () => showScreen('main-menu'));
            
            // –ö–Ω–æ–ø–∫–∏ –∏–≥—Ä–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
            document.getElementById('restart-btn').addEventListener('click', restartGame);
            document.getElementById('menu-btn').addEventListener('click', () => showScreen('main-menu'));
            document.getElementById('pause-btn').addEventListener('click', togglePause);
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            window.addEventListener('keydown', (e) => {
                gameState.keys[e.key] = true;
                
                // –ü—Ä–æ–±–µ–ª –¥–ª—è –ø—Ä—ã–∂–∫–∞
                if (e.key === ' ' && !gameState.player.isJumping) {
                    jump();
                }
                
                // P –¥–ª—è –ø–∞—É–∑—ã
                if (e.key === 'p' || e.key === 'P') {
                    togglePause();
                }
            });
            
            window.addEventListener('keyup', (e) => {
                gameState.keys[e.key] = false;
            });
            
            // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            document.getElementById('left-btn').addEventListener('touchstart', () => gameState.keys['ArrowLeft'] = true);
            document.getElementById('left-btn').addEventListener('touchend', () => gameState.keys['ArrowLeft'] = false);
            
            document.getElementById('right-btn').addEventListener('touchstart', () => gameState.keys['ArrowRight'] = true);
            document.getElementById('right-btn').addEventListener('touchend', () => gameState.keys['ArrowRight'] = false);
            
            document.getElementById('jump-btn').addEventListener('touchstart', jump);
            document.getElementById('attack-btn').addEventListener('touchstart', attack);
            
            // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
            gameState.currentScreen = screenId;
        }
        
        // –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
        function startGame() {
            showScreen('game-container');
            gameState.isPaused = false;
            resetGame();
        }
        
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É
        function restartGame() {
            resetGame();
            showScreen('game-container');
            gameState.isPaused = false;
        }
        
        // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function resetGame() {
            gameState.player.x = canvas.width / 2;
            gameState.player.y = canvas.height - 150;
            gameState.player.health = 100;
            gameState.player.energy = 100;
            gameState.player.score = 0;
            gameState.player.floor = 1;
            gameState.player.velocityY = 0;
            gameState.player.isJumping = false;
            gameState.enemies = [];
            gameState.projectiles = [];
            gameState.coins = [];
            gameState.gameTime = 0;
            gameState.enemySpawnTimer = 0;
            gameState.coinSpawnTimer = 0;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HUD
            updateHUD();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—É–∑—ã
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            if (gameState.isPaused) {
                showNotification("–ü–ê–£–ó–ê");
            } else {
                document.getElementById('notification').classList.remove('show');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(text) {
            const notification = document.getElementById('notification');
            notification.textContent = text;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }
        
        // –ü—Ä—ã–∂–æ–∫
        function jump() {
            if (!gameState.player.isJumping) {
                gameState.player.velocityY = -gameState.player.jumpForce;
                gameState.player.isJumping = true;
            }
        }
        
        // –ê—Ç–∞–∫–∞
        function attack() {
            if (gameState.player.energy >= 10) {
                gameState.player.energy -= 10;
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–∞
                gameState.projectiles.push({
                    x: gameState.player.x,
                    y: gameState.player.y,
                    width: 10,
                    height: 10,
                    speed: 10,
                    damage: gameState.player.attackDamage
                });
                
                updateHUD();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HUD
        function updateHUD() {
            document.getElementById('health').textContent = Math.max(0, Math.floor(gameState.player.health));
            document.getElementById('energy').textContent = Math.max(0, Math.floor(gameState.player.energy));
            document.getElementById('coins').textContent = gameState.player.coins;
            document.getElementById('score').textContent = gameState.player.score;
            document.getElementById('floor').textContent = gameState.player.floor;
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (gameState.currentScreen === 'game-container' && !gameState.isPaused) {
                update();
                render();
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
        function update() {
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã
            gameState.gameTime++;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            updatePlayer();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
            updateEnemies();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–æ–≤
            updateProjectiles();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç
            updateCoins();
            
            // –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤
            gameState.enemySpawnTimer++;
            if (gameState.enemySpawnTimer > 120) { // –ö–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ 60 FPS
                spawnEnemy();
                gameState.enemySpawnTimer = 0;
            }
            
            // –°–ø–∞–≤–Ω –º–æ–Ω–µ—Ç
            gameState.coinSpawnTimer++;
            if (gameState.coinSpawnTimer > 180) { // –ö–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
                spawnCoin();
                gameState.coinSpawnTimer = 0;
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
            if (gameState.player.energy < gameState.player.maxEnergy) {
                gameState.player.energy += 0.1;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        function updatePlayer() {
            // –î–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ
            if (gameState.keys['ArrowLeft'] || gameState.keys['a'] || gameState.keys['A']) {
                gameState.player.x -= gameState.player.speed;
            }
            if (gameState.keys['ArrowRight'] || gameState.keys['d'] || gameState.keys['D']) {
                gameState.player.x += gameState.player.speed;
            }
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —ç–∫—Ä–∞–Ω–∞
            if (gameState.player.x < 0) gameState.player.x = 0;
            if (gameState.player.x > canvas.width - gameState.player.width) {
                gameState.player.x = canvas.width - gameState.player.width;
            }
            
            // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
            gameState.player.velocityY += gameState.gravity;
            gameState.player.y += gameState.player.velocityY;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏
            let onPlatform = false;
            for (const platform of gameState.platforms) {
                if (
                    gameState.player.x < platform.x + platform.width &&
                    gameState.player.x + gameState.player.width > platform.x &&
                    gameState.player.y + gameState.player.height > platform.y &&
                    gameState.player.y + gameState.player.height < platform.y + platform.height &&
                    gameState.player.velocityY > 0
                ) {
                    gameState.player.y = platform.y - gameState.player.height;
                    gameState.player.velocityY = 0;
                    gameState.player.isJumping = false;
                    onPlatform = true;
                }
            }
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –ø–∞–¥–∞–µ—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —ç–∫—Ä–∞–Ω–∞
            if (gameState.player.y > canvas.height) {
                gameOver();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
        function updateEnemies() {
            for (let i = gameState.enemies.length - 1; i >= 0; i--) {
                const enemy = gameState.enemies[i];
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–∞ –∫ –∏–≥—Ä–æ–∫—É
                if (enemy.x < gameState.player.x) {
                    enemy.x += enemy.speed;
                } else {
                    enemy.x -= enemy.speed;
                }
                
                // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –¥–ª—è –≤—Ä–∞–≥–æ–≤
                enemy.velocityY += gameState.gravity;
                enemy.y += enemy.velocityY;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏
                for (const platform of gameState.platforms) {
                    if (
                        enemy.x < platform.x + platform.width &&
                        enemy.x + enemy.width > platform.x &&
                        enemy.y + enemy.height > platform.y &&
                        enemy.y + enemy.height < platform.y + platform.height &&
                        enemy.velocityY > 0
                    ) {
                        enemy.y = platform.y - enemy.height;
                        enemy.velocityY = 0;
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∏–≥—Ä–æ–∫–æ–º
                if (
                    gameState.player.x < enemy.x + enemy.width &&
                    gameState.player.x + gameState.player.width > enemy.x &&
                    gameState.player.y < enemy.y + enemy.height &&
                    gameState.player.y + gameState.player.height > enemy.y
                ) {
                    // –£—Ä–æ–Ω –∏–≥—Ä–æ–∫—É
                    gameState.player.health -= enemy.damage;
                    updateHUD();
                    
                    // –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–∞
                    gameState.enemies.splice(i, 1);
                    
                    if (gameState.player.health <= 0) {
                        gameOver();
                    }
                }
                
                // –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
                if (enemy.y > canvas.height) {
                    gameState.enemies.splice(i, 1);
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–æ–≤
        function updateProjectiles() {
            for (let i = gameState.projectiles.length - 1; i >= 0; i--) {
                const projectile = gameState.projectiles[i];
                
                // –î–≤–∏–∂–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–∞
                projectile.x += projectile.speed;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –≤—Ä–∞–≥–∞–º–∏
                for (let j = gameState.enemies.length - 1; j >= 0; j--) {
                    const enemy = gameState.enemies[j];
                    
                    if (
                        projectile.x < enemy.x + enemy.width &&
                        projectile.x + projectile.width > enemy.x &&
                        projectile.y < enemy.y + enemy.height &&
                        projectile.y + projectile.height > enemy.y
                    ) {
                        // –ù–∞–Ω–µ—Å–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –≤—Ä–∞–≥—É
                        enemy.health -= projectile.damage;
                        
                        // –£–¥–∞–ª–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–∞
                        gameState.projectiles.splice(i, 1);
                        
                        // –ï—Å–ª–∏ –≤—Ä–∞–≥ –ø–æ–±–µ–∂–¥–µ–Ω
                        if (enemy.health <= 0) {
                            gameState.enemies.splice(j, 1);
                            gameState.player.score += 10;
                            gameState.player.coins += 5;
                            updateHUD();
                        }
                        
                        break;
                    }
                }
                
                // –£–¥–∞–ª–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–æ–≤ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
                if (projectile.x > canvas.width) {
                    gameState.projectiles.splice(i, 1);
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç
        function updateCoins() {
            for (let i = gameState.coins.length - 1; i >= 0; i--) {
                const coin = gameState.coins[i];
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞ –º–æ–Ω–µ—Ç—ã –∏–≥—Ä–æ–∫–æ–º
                if (
                    gameState.player.x < coin.x + coin.width &&
                    gameState.player.x + gameState.player.width > coin.x &&
                    gameState.player.y < coin.y + coin.height &&
                    gameState.player.y + gameState.player.height > coin.y
                ) {
                    gameState.player.coins += 1;
                    gameState.coins.splice(i, 1);
                    updateHUD();
                    showNotification("+1 –º–æ–Ω–µ—Ç–∞");
                }
                
                // –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
                if (coin.y > canvas.height) {
                    gameState.coins.splice(i, 1);
                }
            }
        }
        
        // –°–ø–∞–≤–Ω –≤—Ä–∞–≥–∞
        function spawnEnemy() {
            const enemyTypes = [
                { health: 20, damage: 5, speed: 2, color: '#00ff00' },
                { health: 30, damage: 10, speed: 1, color: '#ff9900' },
                { health: 50, damage: 15, speed: 0.5, color: '#ff0000' }
            ];
            
            const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
            
            gameState.enemies.push({
                x: Math.random() * canvas.width,
                y: 0,
                width: 40,
                height: 40,
                health: type.health,
                maxHealth: type.health,
                damage: type.damage,
                speed: type.speed,
                velocityY: 0,
                color: type.color
            });
        }
        
        // –°–ø–∞–≤–Ω –º–æ–Ω–µ—Ç—ã
        function spawnCoin() {
            gameState.coins.push({
                x: Math.random() * canvas.width,
                y: 0,
                width: 20,
                height: 20,
                velocityY: 0
            });
        }
        
        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function gameOver() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
            if (gameState.player.score > gameState.highScore) {
                gameState.highScore = gameState.player.score;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            document.getElementById('final-floor').textContent = gameState.player.floor;
            document.getElementById('final-score').textContent = gameState.player.score;
            document.getElementById('final-coins').textContent = gameState.player.coins;
            document.getElementById('final-enemies').textContent = Math.floor(gameState.player.score / 10);
            document.getElementById('final-highscore').textContent = gameState.highScore;
            
            showScreen('game-over-screen');
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
        function render() {
            // –û—á–∏—Å—Ç–∫–∞ canvas
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º
            ctx.fillStyle = '#8b4513';
            for (const platform of gameState.platforms) {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–∞
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(gameState.player.x, gameState.player.y, gameState.player.width, gameState.player.height);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Ä–∞–≥–æ–≤
            for (const enemy of gameState.enemies) {
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                
                // –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
                const healthPercent = enemy.health / enemy.maxHealth;
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(enemy.x, enemy.y - 10, enemy.width, 5);
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(enemy.x, enemy.y - 10, enemy.width * healthPercent, 5);
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–Ω–∞—Ä—è–¥–æ–≤
            ctx.fillStyle = '#ffff00';
            for (const projectile of gameState.projectiles) {
                ctx.fillRect(projectile.x, projectile.y, projectile.width, projectile.height);
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–æ–Ω–µ—Ç
            ctx.fillStyle = '#ffcc00';
            for (const coin of gameState.coins) {
                ctx.beginPath();
                ctx.arc(coin.x + coin.width/2, coin.y + coin.height/2, coin.width/2, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        init();
    </script>
</body>
                        </html>
