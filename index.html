<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShapeScript - WORKING</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #1e1e1e; 
            color: #ffffff; 
            height: 100vh; 
            overflow: hidden; 
        }
        .container { 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            padding: 10px; 
            gap: 10px; 
        }
        .header { 
            background: #2d2d2d; 
            padding: 15px; 
            border-radius: 10px; 
            text-align: center;
        }
        .main-content { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            flex: 1; 
            min-height: 0; 
        }
        .panel { 
            background: #252526; 
            border-radius: 10px; 
            display: flex; 
            flex-direction: column; 
        }
        .panel-header { 
            background: #2d2d2d; 
            padding: 10px 15px; 
            border-bottom: 1px solid #3e3e3e; 
        }
        #editor { 
            width: 100%; 
            height: 100%; 
            background: #1e1e1e; 
            color: #d4d4d4; 
            border: none; 
            padding: 15px; 
            font-family: 'Consolas', monospace; 
            font-size: 14px; 
            resize: none; 
            outline: none; 
        }
        #canvas { 
            width: 100%; 
            height: 100%; 
            background: #1e1e1e; 
        }
        .controls { 
            display: flex; 
            gap: 10px; 
            padding: 15px; 
            background: #2d2d2d; 
        }
        .btn { 
            background: #0e639c; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .btn:hover { background: #1177bb; }
        .error { 
            background: #dc3545; 
            color: white; 
            padding: 10px; 
            margin: 10px; 
            border-radius: 5px; 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® ShapeScript - –†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø</h1>
            <p>–ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏ –∫–æ–¥ –∏ –Ω–∞–∂–º–∏ "Run" - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!</p>
        </div>
        
        <div class="main-content">
            <div class="panel">
                <div class="panel-header">
                    <h3>üìù –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞</h3>
                </div>
                <textarea id="editor" spellcheck="false">
// –ü—Ä–æ—Å—Ç–æ–π –∫—Ä–∞—Å–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç
rect(350, 250, 100, 100, "#ff0000")

// –ò–õ–ò —Ä–∞—Å—Ç—É—â–∏–π –∫—Ä—É–≥ - —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π:
// growCircle(400, 300, 100, "#ff6b6b", 3000)
</textarea>
                <div class="controls">
                    <button class="btn" onclick="runCode()">‚ñ∂Ô∏è Run</button>
                    <button class="btn" onclick="clearCanvas()">üóëÔ∏è Clear</button>
                    <button class="btn" onclick="loadExample('square')">üî¥ –ö–≤–∞–¥—Ä–∞—Ç</button>
                    <button class="btn" onclick="loadExample('circle')">üîµ –ö—Ä—É–≥</button>
                    <button class="btn" onclick="loadExample('grow')">üå± –†–∞—Å—Ç–∏</button>
                </div>
                <div id="error" class="error"></div>
            </div>
            
            <div class="panel">
                <div class="panel-header">
                    <h3>üëÅÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                </div>
                <canvas id="canvas" width="800" height="600"></canvas>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let animationId = null;

        // –û–ß–ï–ù–¨ –ü–†–û–°–¢–û–ô –ò–ù–¢–ï–†–ü–†–ï–¢–ê–¢–û–†
        function runCode() {
            clearCanvas();
            const code = document.getElementById('editor').value;
            document.getElementById('error').style.display = 'none';
            
            try {
                const lines = code.split('\n');
                for (const line of lines) {
                    const trimmed = line.trim();
                    
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                    if (!trimmed || trimmed.startsWith('//')) continue;
                    
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã
                    if (trimmed.startsWith('rect(')) {
                        drawRect(trimmed);
                    } else if (trimmed.startsWith('circle(')) {
                        drawCircle(trimmed);
                    } else if (trimmed.startsWith('growCircle(')) {
                        animateCircle(trimmed);
                    }
                }
            } catch (error) {
                showError(error.message);
            }
        }

        function drawRect(command) {
            const match = command.match(/rect\((\d+),\s*(\d+),\s*(\d+),\s*(\d+),\s*"([^"]+)"\)/);
            if (match) {
                const x = parseInt(match[1]);
                const y = parseInt(match[2]);
                const width = parseInt(match[3]);
                const height = parseInt(match[4]);
                const color = match[5];
                
                ctx.fillStyle = color;
                ctx.fillRect(x, y, width, height);
            }
        }

        function drawCircle(command) {
            const match = command.match(/circle\((\d+),\s*(\d+),\s*(\d+),\s*"([^"]+)"\)/);
            if (match) {
                const x = parseInt(match[1]);
                const y = parseInt(match[2]);
                const radius = parseInt(match[3]);
                const color = match[4];
                
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        function animateCircle(command) {
            const match = command.match(/growCircle\((\d+),\s*(\d+),\s*(\d+),\s*"([^"]+)",\s*(\d+)\)/);
            if (match) {
                const x = parseInt(match[1]);
                const y = parseInt(match[2]);
                const finalRadius = parseInt(match[3]);
                const color = match[4];
                const duration = parseInt(match[5]);
                
                let startTime = Date.now();
                
                function animate() {
                    const currentTime = Date.now();
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // –û—á–∏—â–∞–µ–º –∏ —Ä–∏—Å—É–µ–º
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#1e1e1e';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // –¢–µ–∫—É—â–∏–π —Ä–∞–¥–∏—É—Å
                    const currentRadius = progress * finalRadius;
                    
                    // –†–∏—Å—É–µ–º –∫—Ä—É–≥
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(x, y, currentRadius, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    if (progress < 1) {
                        animationId = requestAnimationFrame(animate);
                    }
                }
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –∞–Ω–∏–º–∞—Ü–∏—é
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
                animate();
            }
        }

        function clearCanvas() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            ctx.fillStyle = '#1e1e1e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = '–û—à–∏–±–∫–∞: ' + message;
            errorDiv.style.display = 'block';
        }

        function loadExample(type) {
            const examples = {
                square: `// –ü—Ä–æ—Å—Ç–æ–π –∫—Ä–∞—Å–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç
rect(350, 250, 100, 100, "#ff0000")`,
                
                circle: `// –°–∏–Ω–∏–π –∫—Ä—É–≥
circle(400, 300, 80, "#0000ff")`,
                
                grow: `// –ö—Ä—É–≥, —Ä–∞—Å—Ç—É—â–∏–π –∏–∑ —Ç–æ—á–∫–∏ –∑–∞ 3 —Å–µ–∫—É–Ω–¥—ã
growCircle(400, 300, 100, "#ff6b6b", 3000)`
            };
            
            document.getElementById('editor').value = examples[type];
            runCode();
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä
        setTimeout(() => {
            document.getElementById('editor').value = `// –ü—Ä–æ—Å—Ç–æ–π –∫—Ä–∞—Å–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç
rect(350, 250, 100, 100, "#ff0000")`;
            runCode();
        }, 100);
    </script>
</body>
</html>
